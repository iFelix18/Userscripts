// ==UserScript==
// @author          Davide <iFelix18@protonmail.com>
// @namespace       https://github.com/iFelix18
// @exclude         *
// ==UserLibrary==
// @name            Jikan API
// @description     Jikan API for my userscripts
// @copyright       2022, Davide (https://github.com/iFelix18)
// @license         MIT
// @version         1.0.1
// @homepageURL     https://github.com/iFelix18/Userscripts
// @supportURL      https://github.com/iFelix18/Userscripts/issues
// ==/UserLibrary==
// @connect         api.jikan.moe
// @grant           GM.xmlHttpRequest
// ==/UserScript==
(()=>{this.Jikan=class{constructor(e={}){this._config={url:e.url||"https://api.jikan.moe",debug:e.debug||!1},this._headers={"User-Agent":"Mozilla/5.0","Content-Type":"application/json;charset=utf-8"},this._debug=(e=>{(this._config.debug||200!==e.status)&&console.log(`${e.status}: ${e.finalUrl}`)})}search(e={}){const t={query:e.query||"",type:"series"===e.type?"tv":e.type||void 0,limit:e.limit||25,page:e.page||1};return new Promise((e,r)=>{GM.xmlHttpRequest({method:"GET",url:`${this._config.url}/v4/anime?q=${encodeURIComponent(t.query)}&type=${t.type}&order_by=popularity&sfw=true&limit=${t.limit}&page=${t.page}`,headers:this._headers,onload:s=>{this._debug(s);const i=JSON.parse(s.responseText).data;""!==t.query&&4===s.readyState&&"[]"!==s.responseText?e(i):r(""===t.query?new Error("A search query is required."):new Error(s))}})})}}})();