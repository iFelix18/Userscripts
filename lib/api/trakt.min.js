// ==UserScript==
// @author          Davide <iFelix18@protonmail.com>
// @namespace       https://github.com/iFelix18
// @exclude         *
// ==UserLibrary==
// @name            Trakt API
// @description     Trakt API for my userscripts
// @copyright       2020, Davide (https://github.com/iFelix18)
// @license         MIT
// @version         1.5.0
// @homepageURL     https://github.com/iFelix18/Userscripts
// @supportURL      https://github.com/iFelix18/Userscripts/issues
// ==/UserLibrary==
// @include         *
// @connect         api.trakt.tv
// @grant           GM.xmlHttpRequest
// ==/UserScript==
(()=>{this.Trakt=class{constructor(e={}){if(!e.clientID)throw new Error("Trakt Client ID is required");this._config={clientID:e.clientID,url:e.url||"https://api.trakt.tv",debug:e.debug||!1},this._headers={"User-Agent":"Mozilla/5.0","Content-Type":"application/json;charset=utf-8","trakt-api-key":this._config.clientID,"trakt-api-version":2},this._debug=(e=>{(this._config.debug||200!==e.status)&&console.log(`${e.status}: ${e.finalUrl}`)})}episodeSummary(e,t,s){return new Promise((o,n)=>{GM.xmlHttpRequest({method:"GET",url:`${this._config.url}/shows/${encodeURIComponent(e)}/seasons/${encodeURIComponent(t)}/episodes/${encodeURIComponent(s)}?extended=full`,headers:this._headers,onload:e=>{this._debug(e),4===e.readyState?o(JSON.parse(e.responseText)):n(e)}})})}search(e,t,s){return new Promise((o,n)=>{GM.xmlHttpRequest({method:"GET",url:`${this._config.url}/search/${encodeURIComponent(e)}?query=${encodeURIComponent(t)}&fields=${encodeURIComponent(s)}`,headers:this._headers,onload:e=>{this._debug(e),4===e.readyState?o(JSON.parse(e.responseText)):n(e)}})})}searchID(e,t,s){return new Promise((o,n)=>{GM.xmlHttpRequest({method:"GET",url:`${this._config.url}/search/${encodeURIComponent(e)}/${encodeURIComponent(t)}?type=${encodeURIComponent(s)}`,headers:this._headers,onload:e=>{this._debug(e),4===e.readyState?o(JSON.parse(e.responseText)):n(e)}})})}seasonsSeason(e,t){return new Promise((s,o)=>{GM.xmlHttpRequest({method:"GET",url:`${this._config.url}/shows/${encodeURIComponent(e)}/seasons/${encodeURIComponent(t)}`,headers:this._headers,onload:e=>{this._debug(e),4===e.readyState?s(JSON.parse(e.responseText)):o(e)}})})}seasonSummary(e){return new Promise((t,s)=>{GM.xmlHttpRequest({method:"GET",url:`${this._config.url}/shows/${encodeURIComponent(e)}/seasons?extended=full`,headers:this._headers,onload:e=>{this._debug(e),4===e.readyState?t(JSON.parse(e.responseText)):s(e)}})})}showSummary(e){return new Promise((t,s)=>{GM.xmlHttpRequest({method:"GET",url:`${this._config.url}/shows/${encodeURIComponent(e)}?extended=full`,headers:this._headers,onload:e=>{this._debug(e),4===e.readyState?t(JSON.parse(e.responseText)):s(e)}})})}}})();