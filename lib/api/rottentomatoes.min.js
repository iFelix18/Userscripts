// ==UserScript==
// @author          Davide <iFelix18@protonmail.com>
// @namespace       https://github.com/iFelix18
// @exclude         *
// ==UserLibrary==
// @name            Rotten Tomatoes API
// @description     Rotten Tomatoes API for my userscripts
// @copyright       2022, Davide (https://github.com/iFelix18)
// @license         MIT
// @version         1.1.5
// @homepageURL     https://github.com/iFelix18/Userscripts
// @supportURL      https://github.com/iFelix18/Userscripts/issues
// ==/UserLibrary==
// @connect         rottentomatoes.com
// @grant           GM.xmlHttpRequest
// ==/UserScript==
(()=>{this.RottenTomatoes=class{constructor(e={}){this._config={url:e.url||"https://www.rottentomatoes.com",debug:e.debug||!1},this._headers={"User-Agent":"Mozilla/5.0","Content-Type":"application/json;charset=utf-8"},this._debug=(e=>{(this._config.debug||200!==e.status)&&console.log(`${e.status}: ${e.finalUrl}`)})}search(e={}){const t={query:e.query||"",type:"movie"===e.type?"movie":"series"===e.type?"tvseries":void 0,limit:e.limit||25};return new Promise((s,r)=>{GM.xmlHttpRequest({method:"GET",url:`${this._config.url}/api/private/v2.0/search/?q=${encodeURIComponent(t.query)}&t=${t.type}&limit=${t.limit}`,headers:this._headers,onload:i=>{this._debug(i);const o=JSON.parse(i.responseText);4===i.readyState&&"[]"!==i.responseText?s("movie"===e.type?o.movies:"series"===e.type?o.tvSeries:void 0):r(""===t.query?new Error("A search query is required."):new Error(i))}})})}}})();