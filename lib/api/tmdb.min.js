// ==UserScript==
// @author          Davide <iFelix18@protonmail.com>
// @namespace       https://github.com/iFelix18
// @exclude         *
// ==UserLibrary==
// @name            TMDb API
// @description     TMDb API for my userscripts
// @copyright       2020, Davide (https://github.com/iFelix18)
// @license         MIT
// @version         1.5.4
// @homepageURL     https://github.com/iFelix18/Userscripts
// @supportURL      https://github.com/iFelix18/Userscripts/issues
// ==/UserLibrary==
// @connect         api.themoviedb.org
// @grant           GM.xmlHttpRequest
// ==/UserScript==
(()=>{this.TMDb=class{constructor(e={}){if(!e.apikey)throw new Error("TMDb API Key is required");this._config={apikey:e.apikey,language:e.language||"en",url:e.url||"https://api.themoviedb.org/3",debug:e.debug||!1},this._headers={"User-Agent":"Mozilla/5.0","Content-Type":"application/json;charset=utf-8"},this._debug=(e=>{(this._config.debug||200!==e.status)&&console.log(`${e.status}: ${e.finalUrl}`)})}episodeDetails(e,t,s){return new Promise((a,i)=>{GM.xmlHttpRequest({method:"GET",url:`${this._config.url}/tv/${e}/season/${t}/episode/${s}?api_key=${this._config.apikey}&language=${this._config.language}`,headers:this._headers,onload:e=>{this._debug(e),4===e.readyState?a(JSON.parse(e.responseText)):i(e)}})})}externalIDs(e,t){return new Promise((s,a)=>{GM.xmlHttpRequest({method:"GET",url:`${this._config.url}/${e}/${t}/external_ids?api_key=${this._config.apikey}`,headers:this._headers,onload:e=>{this._debug(e),4===e.readyState?s(JSON.parse(e.responseText)):a(e)}})})}images(e,t){return new Promise((s,a)=>{GM.xmlHttpRequest({method:"GET",url:`${this._config.url}/${e}/${t}/images?api_key=${this._config.apikey}&language=${this._config.language}`,headers:this._headers,onload:e=>{this._debug(e),4===e.readyState?s(JSON.parse(e.responseText)):a(e)}})})}moviesDetails(e){return new Promise((t,s)=>{GM.xmlHttpRequest({method:"GET",url:`${this._config.url}/movie/${e}?api_key=${this._config.apikey}&language=${this._config.language}`,headers:this._headers,onload:e=>{this._debug(e),4===e.readyState?t(JSON.parse(e.responseText)):s(e)}})})}seasonDetails(e,t){return new Promise((s,a)=>{GM.xmlHttpRequest({method:"GET",url:`${this._config.url}/tv/${e}/season/${t}?api_key=${this._config.apikey}&language=${this._config.language}`,headers:this._headers,onload:e=>{this._debug(e),4===e.readyState?s(JSON.parse(e.responseText)):a(e)}})})}tvDetails(e){return new Promise((t,s)=>{GM.xmlHttpRequest({method:"GET",url:`${this._config.url}/tv/${e}?api_key=${this._config.apikey}&language=${this._config.language}`,headers:this._headers,onload:e=>{this._debug(e),4===e.readyState?t(JSON.parse(e.responseText)):s(e)}})})}}})();